<!DOCTYPE html>

<head>
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <title>JCHS POS</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
        }

        /* width */
        ::-webkit-scrollbar {
            width: 10px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #888;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>

<body>
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
        Account
        <input id="account" type="text">
        <br>
        <br>
        Password
        <input id="pass" type="text">
        <br>
        <br>
        <button id="login">Login</button>
    </div>
</body>

<script>
    //
</script>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";

    //createUserWithEmailAndPassword
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDJ2tr5BgD5euyA_Mdez-GyD0z6JFFb0lY",
        authDomain: "joelcheonghsdata.firebaseapp.com",
        databaseURL: "https://joelcheonghsdata-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "joelcheonghsdata",
        storageBucket: "joelcheonghsdata.appspot.com",
        messagingSenderId: "246172949748",
        appId: "1:246172949748:web:b6de0a64bba1f7f49892a1"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const database = getDatabase(app);

    login.addEventListener('click', (e) => {

        //Retrieve input
        var account = document.getElementById('account').value;
        var pass = document.getElementById('pass').value;

        signInWithEmailAndPassword(auth, account, pass)
            .then((userCredential) => {
                // Signed in 
                const user = userCredential.user;
                var currentdate = new Date();
                var lgDate = currentdate.getDate() + "/"
                    + (currentdate.getMonth() + 1) + "/"
                    + currentdate.getFullYear() + " @ "
                    + currentdate.getHours() + ":"
                    + currentdate.getMinutes() + ":"
                    + currentdate.getSeconds();

                update(ref(database, 'users/' + user.uid), {
                    last_login: lgDate,
                })
                    .then(() => {
                        // User login successfully!
                        console.log(user.uid + ' logged in.');
                        localStorage.setItem("account", account);
                        localStorage.setItem("pass", pass);
                        window.location.href = "staffcode.html";

                    })
                    .catch((error) => {
                        // The write failed...
                        console.log(error);
                    });
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                console.log(errorCode + ' Bug. ' + errorMessage);
            });

    });

</script>

</html>